<style>
    .clearfix {
        *zoom: 1;
    }

    /* For IE 6/7 */
    .clearfix:before, .clearfix:after {
        content: "";
        display: table;
    }

    .clearfix:after {
        clear: both;
    }

    /* ---------- LIVE-CHAT ---------- */

    #live-chat {
        bottom: 0;
        font-size: 12px;
        position: fixed;
        width: 400px;
    }

    #live-chat header {
        background: rgb(7, 97, 246);
        border-radius: 5px 5px 0 0;
        color: #fff;
        cursor: pointer;
        padding: 16px 24px;
    }

    #live-chat h4:before {
        background: #1a8a34;
        border-radius: 50%;
        content: "";
        display: inline-block;
        height: 8px;
        margin: 0 8px 0 0;
        width: 8px;
    }

    #live-chat h4 {
        font-size: 12px;
    }

    #live-chat h5 {
        font-size: 10px;
    }

    #live-chat form {
        padding: 24px;
    }

    #live-chat input[type="text"] {
        border: 1px solid #ccc;
        border-radius: 3px;
        padding: 8px;
        outline: none;
        width: 234px;
    }

    .chat-message-counter {
        background: #e62727;
        border: 1px solid #fff;
        border-radius: 50%;
        display: none;
        font-size: 12px;
        font-weight: bold;
        height: 28px;
        left: 0;
        line-height: 28px;
        margin: -15px 0 0 -15px;
        position: absolute;
        text-align: center;
        top: 0;
        width: 28px;
    }

    .chat-close {
        background: #1b2126;
        border-radius: 50%;
        color: #fff;
        display: block;
        float: right;
        font-size: 10px;
        height: 16px;
        line-height: 16px;
        margin: 2px 0 0 0;
        text-align: center;
        width: 16px;
    }

    .chat {
        background: #fff;
        height: 900px;
    }

    .chat-history {
        padding: 8px 2px;
        overflow-y: scroll;
    }

    .chat-message {
        margin: 16px 0;
    }

    .chat-message img {
        border-radius: 50%;
        float: left;
    }

    .chat-message-content {
        margin-left: 56px;
    }

    .chat-time {
        float: right;
        font-size: 10px;
    }

    .chat-feedback {
        font-style: italic;
        margin: 0 0 0 80px;
    }
</style>

<header class="clearfix">
    <h4>Mehmet Mert</h4>

    <span class="chat-message-counter">3</span>
    <button style="display: inline" type="button" class="btn-close waves-effect waves-light" data-bs-dismiss="modal"
            aria-label="Close" id="btn-compare-close-product"></button>

</header>

<div class="chat">

    <div class="chat-history">
        <textarea class="w-98" id="chat-log" cols="48" rows="12" readonly="readonly"></textarea>

    </div> <!-- end chat-history -->
    <fieldset style="bottom: 5px">
        <input id="chat-message-input" type="text" size="100">
        <button onclick="readfile()"><i class="bi bi-paperclip"></i></button>
        <button id="chat-message-submit" class="btn-success"><i class="bi bi-caret-left-fill"></i></button>
        <input type="hidden" id="chat-replay-id">
        <input id="chat-file" type="file">
        {{ room_id|json_script:"room-name" }}

    </fieldset>


</div> <!-- end chat -->

<script>
    const roomName = JSON.parse(document.getElementById('room-name').textContent);

    const replay_id = document.getElementById('chat-replay-id')

    const chatSocket = new WebSocket(
        'ws://'
        + window.location.host
        + '/ws/chat/'
        + roomName
        + '/'
    );

    const fileSocket = new WebSocket(
        'ws://'
        + window.location.host
        + '/ws/file/'
        + roomName
        + '/'
    );

    chatSocket.onmessage = function (e) {
        const data = JSON.parse(e.data);
        document.querySelector('#chat-log').value += (data.message + '\n');
    };


    chatSocket.onclose = function (e) {
        console.error('Chat socket closed unexpectedly');
    };

    document.querySelector('#chat-message-input').focus();
    document.querySelector('#chat-message-input').onkeyup = function (e) {
        if (e.key === 'Enter') {  // enter, return
            document.querySelector('#chat-message-submit').click();
        }
    };

    document.querySelector('#chat-message-submit').onclick = function (e) {
        const messageInputDom = document.querySelector('#chat-message-input');
        const message = messageInputDom.value;
        chatSocket.send(JSON.stringify({
            'message': message,
            'event': 'message'
        }))
        messageInputDom.value = '';
    }

    function readFile() {
        if (this.files && this.files[0]) {
            var file = document.getElementById("chat-file")
            var FR = new FileReader();

            FR.addEventListener("load", function (e) {

                fileSocket.send(JSON.stringify({
                    'file': e.target.result,
                    'name': file.value,
                    'event': 'file'
                }));
            });

            FR.readAsDataURL(this.files[0]);
        }

    }

    document.getElementById("chat-file").addEventListener("change", readFile);
</script>
<script>
    (function () {

        $('#live-chat header').on('click', function () {

            $('.chat').slideToggle(300, 'swing');
            $('.chat-message-counter').fadeToggle(300, 'swing');

        });

        $('.chat-close').on('click', function (e) {

            e.preventDefault();
            $('#live-chat').fadeOut(300);

        });

    })();
</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>









