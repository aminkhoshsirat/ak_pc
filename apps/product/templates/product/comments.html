{% load static %}
{% load django_template_maths %}
<div class="comment-form py-20">
    <h6 class="font-16">نظرت در مورد این محصول چیه؟</h6>
    <p class="font-14 text-muted mt-2">برای ثبت نظر، از طریق دکمه افزودن دیدگاه جدید
        نمایید. اگر این محصول را قبلا خریده باشید، نظر شما به عنوان خریدار ثبت خواهد
        شد.</p>
    <div class="row gy-4">
        <div class="col-md-4">
            <div class="product-rateing position-sticky top-0">
                <div class="row gy-2 align-items-center">
                    <div class="number">
                        <p class="font-14 text-muted">متوسط امتیاز ها</p>
                        <h2>{{ comment_average_grade.avg | floatformat:-2 }}</h2>
                        <div class="star">
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star"></i>
                        </div>
                    </div>
                    <div class="prog-rating">
                        <div class="item w-100 mb-2">
                            <div class="d-flex align-items-center flex-wrap">
                                <span class="font-14">5 ستاره</span>
                                <div class="progress flex-grow-1 mx-2"
                                     style="height: 7px;">
                                    <div class="progress-bar" role="progressbar"
                                         style="width: {{ star5_num | div:comments.count | mul:100 }}%" aria-valuenow="25"
                                         aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <span class="font-14">{{ star5_num }}</span>
                            </div>
                        </div>
                        <div class="item w-100 mb-2">
                            <div class="d-flex align-items-center flex-wrap">
                                <span class="font-14">4 ستاره</span>
                                <div class="progress flex-grow-1 mx-2"
                                     style="height: 7px;">
                                    <div class="progress-bar" role="progressbar"
                                         style="width: {{ star4_num | div:comments.count | mul:100 }}%" aria-valuenow="25"
                                         aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <span class="font-14">{{ star4_num }}</span>
                            </div>
                        </div>
                        <div class="item w-100 mb-2">
                            <div class="d-flex align-items-center flex-wrap">
                                <span class="font-14">3 ستاره</span>
                                <div class="progress flex-grow-1 mx-2"
                                     style="height: 7px;">
                                    <div class="progress-bar" role="progressbar"
                                         style="width: {{ star3_num | div:comments.count | mul:100 }}%" aria-valuenow="25"
                                         aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <span class="font-14">{{ star3_num }}</span>
                            </div>
                        </div>
                        <div class="item w-100 mb-2">
                            <div class="d-flex align-items-center flex-wrap">
                                <span class="font-14">2 ستاره</span>
                                <div class="progress flex-grow-1 mx-2"
                                     style="height: 7px;">
                                    <div class="progress-bar" role="progressbar"
                                         style="width: {{ star2_num | div:comments.count | mul:100 }}%" aria-valuenow="25"
                                         aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <span class="font-14">{{ star2_num }}</span>
                            </div>
                        </div>
                        <div class="item w-100">
                            <div class="d-flex align-items-center flex-wrap">
                                <span class="font-14">1 ستاره</span>
                                <div class="progress flex-grow-1 mx-2"
                                     style="height: 7px;">
                                    <div class="progress-bar" role="progressbar"
                                         style="width: {{ star1_num | div:comments.count | mul:100 }}%" aria-valuenow="25"
                                         aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <span class="font-14">{{ star1_num }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-8">
            <div class="row">
                <form method="post" action="/product/comment/2/">
                    {% csrf_token %}
                    <div class="col-12">
                        <div class="form-group">
                            <label class="my-3">امتیاز شما</label>
                            <fieldset class="rating">
                                <input type="radio" id="star5" name="grade" value="5"
                                       required/>
                                <label for="star5">5 stars</label>
                                <input type="radio" id="star4" name="grade" value="4"
                                       required/>
                                <label for="star4">4 stars</label>
                                <input type="radio" id="star3" name="grade" value="3"
                                       required/>
                                <label for="star3">3 stars</label>
                                <input type="radio" id="star2" name="grade" value="2"
                                       required/>
                                <label for="star2">2 stars</label>
                                <input type="radio" id="star1" name="grade" value="1"
                                       required/>
                                <label for="star1">1 star</label>
                            </fieldset>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="form-floating">
                        <textarea class="form-control"
                                  placeholder="Leave a comment here"
                                  id="floatingTextarea2"
                                  style="height: 150px" name="text"></textarea>
                            <label for="floatingTextarea2">متن نظر!</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group mt-3">
                            <label for="tags-pos" class="text-success mb-2">نقاط
                                قوت</label>
                            <input name="positive_votes" id="tags-pos"
                                   class="commentTags form-control"
                                   placeholder="با کلید اینتر اضافه کنید" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group mt-3">
                            <label for="tags-neg" class="text-danger mb-2">نقاط
                                ضعف</label>
                            <input name="negative_votes" id="tags-neg"
                                   class="commentTags form-control"
                                   placeholder="با کلید اینتر اضافه کنید" required>
                        </div>
                    </div>
                    <div class="col-12">
                        <input href="" type="submit"
                               class="btn border-0 main-color-three-bg my-3 mx-auto d-block waves-effect waves-light">ثبت
                        نظر</input>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% for comment in comments %}
    <div class="comment bg-light shadow-inner mb-4">
        <div class="title">
            <div class="row align-items-center">
                <div class="col-sm-10">
                    <div class="d-flex align-items-center"> {% if comment.user.profile_image %}
                        <div class="avatar p-2 bg-white shadow-box rounded-circle">
                            <img src="{{ comment.user.profile_image.url }}" alt="{{ comment.user.fullname }}"
                                 class="img-fluid rounded-circle">
                        </div>
                    {% else %}
                        <i class="bi bi-person-circle" style="font-size: 40px"></i>
                    {% endif %}
                        <div class="d-flex flex-wrap align-items-center ms-2">
                            <h6 class="text-muted font-14">{{ comment.user.fullname }}</h6>
                            <h6 class="text-muted font-14 ms-2">{{ comment.published_date | date:"Y-m-d" }}</h6>
                        </div>
                    </div>
                </div>
                <div class="col-sm-2">
                    <div class="d-flex star justify-content-end" id="comment-star-{{ forloop.counter }}">
<i class="bi bi-star-fill"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="desc py-3">
            <p class="font-14 text-muted">
                {{ comment.text }}
            </p>
        </div>
        <div class="foot">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <div class="comment-rates">
                        <div class="positive rounded-4 py-md-0 py-3">
                            <div class="d-flex align-items-center flex-wrap">
                                <h6 class="font-14">نقاط قوت</h6>
                                <nav class="navbar navbar-expand positive-nav">
                                    <ul class="navbar-nav flex-wrap" id="pos-votes-li">
                                        {% for vote in comment.positive_votes %}
                                        <li class="nav-item"><span
                                                class="nav-link font-14">{{ vote }}</span></li>
                                        {% endfor %}
                                    </ul>
                                </nav>
                            </div>
                        </div>
                        <div class="negitive rounded-4 mt-3 py-md-0 py-3">
                            <div class="d-flex align-items-center flex-wrap">
                                <h6 class="font-14">نقاط صعف</h6>
                                <nav class="navbar navbar-expand negitive-nav">
                                    <ul class="navbar-nav flex-wrap" id="neg-votes-li">
                                        {% for vote in comment.negative_votes %}
                                        <li class="nav-item"><span
                                                class="nav-link font-14">{{ vote }}</span></li>
                                            {% endfor %}
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <br>
            {% if comment.admin_solve %}
                <div class="comment shadow-inner mb-4" style="background: #11c56b1f;">
                    <div class="title">
                        <div class="row align-items-center">
                            <div class="col-sm-10">
                                <div class="d-flex align-items-center"> {% if comment.admin_solve.profile_image %}
                                    <div class="avatar p-2 bg-white shadow-box rounded-circle">
                                        <img src="{{ comment.user.profile_image.url }}"
                                             alt="{{ comment.admin_solve.fullname }}"
                                             class="img-fluid rounded-circle">
                                    </div>
                                {% else %}
                                    <i class="bi bi-person-circle" style="font-size: 40px"></i>
                                {% endif %}
                                    <div class="d-flex flex-wrap align-items-center ms-2">
                                        <h6 class="text-muted font-14">پاسخ ادمین: {{ comment.user.fullname }}</h6>
                                        <h6 class="text-muted font-14 ms-2">{{ comment.published_date | date:"Y-m-d" }}</h6>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="desc py-3">
                        <p class="font-14 text-muted">
                            {{ comment.admin_solve_text }}
                        </p>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>

{% endfor %}
<script src="{% static 'plugin/tagify/jQuery.tagify.min.js' %}"></script>
    <script>
        $(document).ready(function () {
            ///input tag
            $('.commentTags').tagify();
        });
    </script>